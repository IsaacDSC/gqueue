name: Debug Retest

on:
  issue_comment:
    types: [created]

jobs:
  debug:
    if: github.event.issue.pull_request
    runs-on: ubuntu-latest
    steps:
      - name: Debug info
        run: |
          echo "Event: ${{ github.event_name }}"
          echo "Comment body: '${{ github.event.comment.body }}'"
          echo "Is PR: ${{ github.event.issue.pull_request != null }}"
          echo "PR number: ${{ github.event.issue.number }}"
          echo "Repository: ${{ github.repository }}"

      - name: Check retest command
        run: |
          COMMENT="${{ github.event.comment.body }}"
          echo "Checking comment: '$COMMENT'"

          if [[ "$COMMENT" == *"retest"* ]]; then
            echo "✅ Retest command found!"
            echo "retest_detected=true" >> $GITHUB_OUTPUT
          else
            echo "❌ No retest command"
            echo "retest_detected=false" >> $GITHUB_OUTPUT
          fi
        id: check

      - name: React if retest
        if: steps.check.outputs.retest_detected == 'true'
        uses: peter-evans/create-or-update-comment@v3
        with:
          comment-id: ${{ github.event.comment.id }}
          reactions: "+1"

      - name: Simple test
        if: steps.check.outputs.retest_detected == 'true'
        run: |
          echo "🎉 Retest workflow triggered successfully!"
          echo "This would normally run your tests here"
